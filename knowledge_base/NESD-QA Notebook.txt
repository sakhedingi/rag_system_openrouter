# üìò NESD-QA Gherkin Scripting Knowledge Base (RAG-Ready Format)

---

## üß≠ Purpose

This guide aligns Test Analysts and Test Automators on how to write Gherkin scripts for NESD-QA automation. It defines expected syntax, reusable steps, and domain-specific parameters for consistent test automation.

---

## üìö Glossary

| Term     | Definition                                                  |
|----------|-------------------------------------------------------------|
| UNITS    | Unit code for SMS bundles on Fusion                         |
| MINUTES  | Unit code for Voice bundles on Fusion                       |
| MB, GB   | Unit codes for Data bundles on Fusion                       |

---

## üì± Subscriber Profile Management

### Create New Subscriber

- **Step:**  
  `Given New subscriber <Subscriber_type> profile is <Offerring_Code>`
	Subscriber_type can be any random test number (eg. 27639568950)

- **Behavior:**  
  Deletes and recreates MSISDN profile on CCS using `<Offerring_Code>` (e.g., "NOF5", "WF5").

---

### Create Multiple Subscribers

- **Step:**  
  `Given Multiple New subscribers <Hybrid_Subscriber> profile is <Hybrid_Offerring_Code> and <Prepaid_Subscriber> profile is <Prepaid_Offerring_Code>`

- **Behavior:**  
  Creates two subscriber profiles:
  - Hybrid: `<Hybrid_Subscriber>` with `<Hybrid_Offerring_Code>` (e.g., "WF12")
  - Prepaid: `<Prepaid_Subscriber>` with `<Prepaid_Offerring_Code>` (e.g., "NOF7")

---

### Use Existing Subscriber

- **Step:**  
  `Given Existing subscriber is <Subscriber_type> with offering code <Offerring_Code>`

- **Behavior:**  
  Reuses an existing MSISDN without recreating it.

---

### Create CUR Profile

- **Step:**  
  ```
  And CUR profile is set with attributes
  {
    "billingplatformid": "300",
    "paymenttype": "P"
  }
  ```

- **Notes:**
  - `"paymenttype"`: "P" = Prepaid, "H" = Hybrid, "C" = Postpaid
  - Always use triple quotes and comma-separated attributes

---

## üîÅ Fusion Transactions

### Set FI Details

- **Step:**  
  `And Set FI specific details "FI Code" is <FICode> and schemeAgencyName is <Company>`

---

### Eligibility Checks

- **Swagger:**  
  `And send Swagger eligibility for "<Recharge_Amount>"`  
  `And send Swagger eligibility for <SOID>`

- **Non-Swagger:**  
  `And send nonSwagger eligibility for "<Recharge_Amount>"`  
  `And send nonSwagger eligibility for <SOID>`

---

### Airtime Recharge

- **Swagger:**  
  `When Sweggar recharge via FI Fusion recharge value of <Recharge_Amount> ZAR`

- **Non-Swagger:**  
  `When nonSweggar recharge via FI Fusion recharge value of <Recharge_Amount> ZAR`

---

### Bundle Purchase via Fusion

- **SOID-based:**  
  `When I purchase via fusion soid is <SOID> price is <Purchase_Amount> bundle size is <Bundle_Size> unit code is <unit_code> validity period is <validity_period>`

- **Product ID-based:**  
  `When I purchase via fusion product id is <Product_ID> price is <Purchase_Amount> bundle size is <Voice_Bundle> unit code is <unit_code>`

- **Delete Bundle:**  
  `When I Delete Bundle via fusion soid is <SOID> price is <Purchase_Amount> bundle size is <Data_Bundle> unit code is <unit_code> validity period is <validity_period>`

---

### Add-to-Bill Purchase

- **Steps:**
  ```
  And Set Additional Fusion Properties <additionalstr>
  When Subscriber using "Add-To-Bill" purchases bundle <SOID> price is <Purchase_Amount> bundle size is <Data_Bundle> validity period is <validity_period>
  ```

- **Payload Format:**  
  `"FI_cost:12/FormatId:B005"`

---

## üí∞ Airtime Balance Adjustments

- **Step:**  
  `And Subscriber <MonetaryType_Code> balance is <Recharge_amount>`

- **Examples:**  
  - `MonetaryType_Code = "C_VZA_PPS_MainAccount"`  
  - `Recharge_amount = 4.00`

---

## ‚úÖ Verification Steps

### CCS Bundle Provisioning

- **Non-Prorated:**  
  `Then Data bundle for OfferingID <OfferingID> allocated is <Bundle_Size>`

- **Prorated:**  
  `Then Data bundle for OfferingID <OfferingID> allocated is <Bundle_Size> free unit is <FreeUnit> <Prorated>`

- **Other Types:**  
  - `Then SMS bundle for OfferingID...`  
  - `Then Voice bundle for OfferingID...`  
  - `Then Total Data bundle for OfferingID...`

---

### Airtime Balance Verification

- **Deduction:**  
  `Then amount <Purchase_Amount>ZAR is deducted from <Recharge_amount> <MonetaryType_Code> money counter`

- **Credit:**  
  `Then amount <Purchase_Amount>ZAR is credited into <MonetaryType_Code> money counter`

- **Instant Recharge Limit:**  
  `And Verify instant Recharge limit is <InstantRechargeLimit>cents`

---

### Expiry Period

- **Days-based:**  
  `And Expiry period is <Expiry_Date> with Offerring ID <OfferingID>`

- **Calendar Month-based:**  
  `And Expiry period is <Expiry_Date> with Offerring ID <OfferingID> and free unit <FreeUnit> calendar month <Prorated>`

---

### Fusion Verification

- **Balance:**  
  `Then verify "C_VZA_PPS_MainAccount" service balances remaining airtime`

- **Bundle:**  
  `Then fusion service bundle <FreeUnit> <OfferingID> for product <Product_Name> is <Bundle_Size> <Prorated>`

- **Validity:**  
  `Then fusion service validity <FreeUnit> <OfferingID> <Validity_Type> for product <Product_Name> is <Expiry_Date>`

- **Description:**  
  `Then verify fusion <FreeUnit> <OfferingID> <Product_Name> <Product_desc>`

---

## üîÅ Voice, Data, Airtime Advance

- **Purchase:**  
  `When I purchase via fusion product id is <Product_ID> price is <Purchase_Amount> and service fee <Servicefee>`

- **Verify Loan:**  
  `Then amount <Purchase_Amount>ZAR is added into <LoanAmount>ZAR loan counter`

- **Verify Deduction:**  
  `Then outstanding amount <Purchase_Amount>ZAR and service <Servicefee>ZAR is deducted from recharge amount <Recharge_Amount>ZAR`

---

## üë• Buy for Another

- **Setup:**  
  `Given Multiple New subscribers <Subscriber_type1> profile is <Offerring_Code1> and <Subscriber_type2> profile is <Offerring_Code2>`

- **Purchase:**  
  `When I buy for another via fusion soid is <SOID> price is <Purchase_Amount> bundle size is <Data_Bundle> unit code is <unit_code> validity period is <validity_period>`

- **Verify Transfer:**  
  `And Data bundle for OfferingID <OfferingID> allocated is <Data_Bundle> is transfered to <Subscriber_type2> with free unit code <FreeUnit> <Prorated>`

---

## ‚úâÔ∏è SMS Verification

- **Template:**  
  `And SMS template for SOID <SOID> is "Your {0} bundle has been provisioned and will be valid until {1,date,yyyy-MM-dd 'at' HH:mm:ss}."`

- **Message Verification:**  
  `And SMS message for SOID <SOID> bundle size <Data_Bundle> and expiry date <Expiry_Date> and calendar month <Prorated> is sent`

---

## üîÑ FreeChange

- **Steps:**
  ```
  And Subscriber is eligible to change to <toOffer>
  When subscriber performs free change from product offer <Offerring_Code> to product offer <toOffer>
  Then subscriber product offer is <toOffer>
  ```

---

## üéÅ Vodabucks

- **Add:**  
  `When add {double} vodabucks for the subscriber`

- **Deduct:**  
  `Then verify that {double} vodabucks is deducted for the subscriber`

- **Verify Allocation:**  
  `Then verify that {double} vodabucks is allocated for the subscriber`

- **Balance Check:**  
  `And get vodabucks balance for the subscriber`

- **Banking:**  
  `And bank vodabucks for the subscriber`

---

**VoMS:**

When Subscriber redeems valid voucher for voucher type <Voucher_type> via IVR
When Subscriber redeems valid voucher for voucher type <Voucher_type> via USSD
When Subscriber redeems valid voucher for voucher type <Voucher_type> via SMS

‚Ä¢ For all three VOMS redeems functions, this will perform VOMS voucher redeem/recharge based on the provided Voucher_type
‚Ä¢ The function will automatically perform a voucher PIN generation if there is no existing and active voucher in batch stored in the database.

Product Description                       | Denomination | Voucher Type | Code
--------------------------------------------------------------------------------
R 110 PIN vodago                          | 110          | vodago       | 31
R 275 PIN vodago                          | 275          | vodago       | 36
R 29 PIN vodago                           | 29           | vodago       | 16
R60 Yebo5 PIN                             | 12           | PIN          | 42
R49 SMS PIN                               | 49           | PIN          | 44
R49 SMS PIN                               | 49           | PIN          | 43
R25 Yebo5 PIN                             | 5            | PIN          | 6
P 60Min VB Pin                             | 5            | Pin          | 4722
P 10Min VB Pin                             | 2            | Pin          | 4724
P 10Min VB Pin                             | 2            | Pin          | 4720
P 50MB 1Hr Pin                             | 5            | Pin          | 4726
P 50MB 1Hr Pin                             | 5            | Pin          | 4727
MyMeg500DB Pin - 30 Days                  | 79           | Pin          | 5205
MyGig1DB Pin - 30 Days                    | 99           | Pin          | 5206
MONTHLY 20GB PIN                          | 699          | PIN          | 5211
Monthly 50MB PIN                          | 12           | PIN          | 5215
Monthly 325MB PIN                         | 55           | PIN          | 5217
Daily 60MB PIN                            | 9            | PIN          | 5226
Daily 100MB PIN                           | 15           | PIN          | 5227
Daily 250MB PIN                           | 27           | PIN          | 5228
Weekly 100MB PIN                          | 17           | PIN          | 5229
Weekly 1GB PIN                            | 80           | PIN          | 5232
Weekly 2GB PIN                            | 120          | PIN          | 5233
100MB Recur 6 Months PIN                  | 119          | PIN          | 5236
250MB Recur 6 Months PIN                  | 219          | PIN          | 5237
WEEKLY 120MB R17 PIN                      | 17           | PIN          | 5390
WEEKLY 2GB R99 PIN                        | 99           | PIN          | 5373
WEEKLY 5GB R199 PIN                       | 199          | PIN          | 5374
MONTHLY 2GB R149 PIN                      | 149          | PIN          | 5375
WEEKLY 500MB R49 PIN                      | 49           | PIN          | 5371
Monthly 3GB PIN                           | 229          | PIN          | 5208
WEEKLY 1GB R69 PIN                        | 69           | PIN          | 5372
Monthly 350MB                             | 49           | (none)       | 5194
MONTHLY 5GB PIN                           | 349          | PIN          | 5209
R 55 PIN vodago                           | 55           | vodago       | 26
Daily 20MB PIN                            | 5            | PIN          | 5225
WEEKLY 250MB R29 PIN                      | 29           | PIN          | 5370
R25 Yebo5 PIN                             | 5            | PIN          | 5
WA 250MB 1DAY R5 PIN                      | 4            | PIN          | 9484
R2.00 Electronic PIN                      | 2            | PIN          | 96
WA 50MB 1DAY R3 PIN                       | 3            | PIN          | 9482
R799/M50GB30D                             | 799          | (none)       | 5396
R60 Yebo5 PIN                             | 12           | PIN          | 41
WA 250MB 7DAY R12 PIN                     | 12           | PIN          | 9485
R0 Variable Pin                           | 0            | Pin          | 99
R 55 PIN vodago                           | 55           | vodago       | 25
WA 100MB 3DAY R6 PIN                      | 6            | PIN          | 9483
Monthly 1GB                               | 85           | (none)       | 5196
MONTHLY 30GB R699                         | 699          | (none)       | 5392
MONTHLY 4GB R249 PIN                      | 249          | PIN          | 5376
R 1100 PIN vodago                         | 1100         | vodago       | 37
Weekly 250MB PIN                          | 35           | PIN          | 5230
Monthly 500MB                             | 69           | (none)       | 5195
MONTHLY 10GB PIN                          | 469          | PIN          | 5210
Weekly 500MB PIN                          | 60           | PIN          | 5231
3GB 7Days PIN                             | 129          | PIN          | 5395
MONTHLY 15GB R529 PIN                     | 529          | PIN          | 5377
R 29 PIN vodago                           | 29           | vodago       | 15
Monthly 150MB PIN                         | 29           | PIN          | 5216
14Day 1GB PIN                             | 100          | PIN          | 5234
R 1100 PIN vodago                         | 1100         | vodago       | 38
R 275 PIN vodago                          | 275          | vodago       | 35
R 110 PIN vodago                          | 110          | vodago       | 32
R 10 Electronic PIN                       | 10           | PIN          | 98
MONTHLY 6GB R349 PIN                      | 349          | PIN          | 5391
R999/M100GB30D/TW365                      | 999          | (none)       | 5397
Monthly 200MB                             | 29           | (none)       | 5198
Hisence 30GB 30Days R599 PIN              | 599          | PIN          | 6779
R35.00 WhatsApp 1GB - 30 Day              | 35           | (none)       | 6782
Mobicel Epic 54GB 30Days R1199 PIN        | 1199         | PIN          | 6780
Mobicel Oreo 30GB 30Days R599 PIN         | 599          | PIN          | 6778
ITEL 54GB 30Days R1199 PIN                | 1199         | PIN          | 6781